<!DOCTYPE html>
<html lang="es">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <title>Instalación y configuración inicial de OpenLDAP | Javier Pérez Hidalgo</title>

        <!-- Bootstrap Core CSS -->
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="/theme/css/code_blocks/darkly.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="Realiza la instalación y configuración básica de OpenLDAP en Freston utilizando como base el nombre DNS asignado. Crea dos unidades...">

        <meta name="author" content="Javier Pérez Hidalgo">

        <meta name="tags" content="LDAP">
        <meta name="tags" content="OpenStack">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="Javier Pérez Hidalgo">

	<meta property="og:type" content="article">
            <meta property="article:author" content="/author/javier-perez-hidalgo.html">
	<meta property="og:url" content="/instalacion-y-configuracion-inicial-de-openldap.html">
	<meta property="og:title" content="Instalación y configuración inicial de OpenLDAP">
	<meta property="article:published_time" content="2020-12-14 00:00:00+01:00">
            <meta property="og:description" content="Realiza la instalación y configuración básica de OpenLDAP en Freston utilizando como base el nombre DNS asignado. Crea dos unidades...">

            <meta property="og:image" content="theme/images/banner-sistemas.jpg">
</head>

<body class="article-instalacion-y-configuracion-inicial-de-openldap">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
        <!--    <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>-->
                <a class="navbar-brand" href="/">Inicio</a>
                <a class="navbar-brand" href="/categories">Categorías</a>
                <a class="navbar-brand" href="/authors">Sobre mí</a>

            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/theme/images/banner-sistemas.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Instalación y configuración inicial de OpenLDAP</h1>
                        <span class="meta">Publicado por
                                <a href="/author/javier-perez-hidalgo.html">Javier Pérez Hidalgo</a>
                             el lun 14 diciembre 2020
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <h4>Realiza la instalación y configuración básica de OpenLDAP en Freston utilizando como base el nombre DNS asignado.</h4>
<h4>Crea dos unidades organizativas, una para personas y otra para grupos.</h4>
<p>Vamos a proceeder con la instalación de <strong>LDAP</strong>.</p>
<p>El servidor <strong>OpenLDAP</strong> está disponible en el paquete <code>slapd</code>. También nos conviene instalar el paquete <code>ldap-utils</code> que contiene utilidades adicionales:</p>
<pre>
apt install slapd ldap-utils -y
</pre>

<p>Durante la instalación, se nos abrirá esta ventana emergente donde nos pedirá que introduzcamos la contraseña de administrador de este nuevo <strong>LDAP</strong>:</p>
<pre>
┌─────────────────────────┤ Configuring slapd ├──────────────────────────┐
│ Please enter the password for the admin entry in your LDAP directory.  │
│                                                                        │
│ Administrator password:                                                │
│                                                                        │
│ ______________________________________________________________________ │
│                                                                        │
│                                 <\Ok\>                                 │
│                                                                        │
└────────────────────────────────────────────────────────────────────────┘
</pre>

<p>Una vez hemos instalado estos paquetes, podemos pasar a llevar a cabo la configuración inicial del servidor.</p>
<p>Los archivos de configuración del servidor <strong>LDAP</strong> se almacenan en la carpeta <code>/etc/ldap/</code>. Pero en lugar de editar manualmente dichos archivos, es mejor ejecutar el asistente de configuración de <code>slapd</code>. Para ello debemos ejecutar el siguiente comando:</p>
<pre>
dpkg-reconfigure slapd
</pre>

<p>Se nos abrirá un asistente y en primer lugar nos preguntara si deseamos omitir la configuración del <em>servidor LDAP</em>:</p>
<pre>
┌───────────────────────────────────┤ Configuring slapd ├───────────────────────────────────┐
│                                                                                           │
│ If you enable this option, no initial configuration or database will be created for you.  │
│                                                                                           │
│ Omit OpenLDAP server configuration?                                                       │
│                                                                                           │
│                          <\Yes\>                             <\No\>                       │
│                                                                                           │
└───────────────────────────────────────────────────────────────────────────────────────────┘
</pre>

<p>Respondemos que no, ya que precisamente lo que queremos es configurar el <em>servidor LDAP</em>.</p>
<p>Ahora, es el momento de especificar el nombre de dominio <strong>DNS</strong>:</p>
<pre>
┌───────────────────────────────────┤ Configuring slapd ├────────────────────────────────────┐
│ The DNS domain name is used to construct the base DN of the LDAP directory. For example,   │
│ 'foo.example.org' will create the directory with 'dc=foo, dc=example, dc=org' as base DN.  │
│                                                                                            │
│ DNS domain name:                                                                           │
│                                                                                            │
│ javierpzh.gonzalonazareno.org_____________________________________________________________ │
│                                                                                            │
│                                           <\Ok\>                                           │
│                                                                                            │
└────────────────────────────────────────────────────────────────────────────────────────────┘
</pre>

<p>Nombre de la Organización. En mi caso, establezco el mismo:</p>
<pre>
┌──────────────────────────────────┤ Configuring slapd ├───────────────────────────────────┐
│ Please enter the name of the organization to use in the base DN of your LDAP directory.  │
│                                                                                          │
│ Organization name:                                                                       │
│                                                                                          │
│ javierpzh.gonzalonazareno.org___________________________________________________________ │
│                                                                                          │
│                                          <\Ok\>                                          │
│                                                                                          │
└──────────────────────────────────────────────────────────────────────────────────────────┘
</pre>

<p>En este punto, nos pedirá que introduzcamos una contraseña.</p>
<p>Acto seguido, tendremos que indicar que tipo de motor de base de datos vamos a utilizar. Yo selecciono el valor por defecto <strong>MDB</strong>:</p>
<pre>
┌───────────────────────────────────────┤ Configuring slapd ├───────────────────────────────────────┐
│ HDB and BDB use similar storage formats, but HDB adds support for subtree renames. Both support   │
│ the same configuration options.                                                                   │
│                                                                                                   │
│ The MDB backend is recommended. MDB uses a new storage format and requires less configuration     │
│ than BDB or HDB.                                                                                  │
│                                                                                                   │
│ In any case, you should review the resulting database configuration for your needs. See           │
│ /usr/share/doc/slapd/README.Debian.gz for more details.                                           │
│                                                                                                   │
│ Database backend to use:                                                                          │
│                                                                                                   │
│                                               BDB                                                 │
│                                               HDB                                                 │
│                                               MDB                                                 │
│                                                                                                   │
│                                                                                                   │
│                                              <\Ok\>                                               │
│                                                                                                   │
└───────────────────────────────────────────────────────────────────────────────────────────────────┘
</pre>

<p>La respuesta de este apartado afectará cuando desinstalemos el paquete <code>slapd</code>, ya que si marcamos que sí, al hacer un <code>apt remove --purge slapd</code> se eliminará también la base de datos asociada al <em>servidor LDAP</em>.</p>
<pre>
┌─────────────────────┤ Configuring slapd ├─────────────────────┐
│                                                               │
│                                                               │
│                                                               │
│ Do you want the database to be removed when slapd is purged?  │
│                                                               │
│                <\Yes\>                   <\No\>               │
│                                                               │
└───────────────────────────────────────────────────────────────┘
</pre>

<p>Yo respondo que sí.</p>
<p>Vamos con la última pregunta. Nos informa que en el directorio <code>/var/lib/ldap</code> existe la configuración previa de la que se ha creado anteriormente, y nos da la opción de remover esa configuración y sustituirla por esta nueva.</p>
<pre>
┌──────────────────────────────────────┤ Configuring slapd ├───────────────────────────────────────┐
│                                                                                                  │
│ There are still files in /var/lib/ldap which will probably break the configuration process. If   │
│ you enable this option, the maintainer scripts will move the old database files out of the way   │
│ before creating a new database.                                                                  │
│                                                                                                  │
│ Move old database?                                                                               │
│                                                                                                  │
│                            <\Yes\>                               <\No\>                          │
│                                                                                                  │
└──────────────────────────────────────────────────────────────────────────────────────────────────┘
</pre>

<p>En mi caso, respondo que sí.</p>
<p>Y ya, vemos como se cierra el asistente y habría terminado el proceso de configuración inicial de <em>LDAP</em>:</p>
<pre>
root@freston:~# dpkg-reconfigure slapd
  Backing up /etc/ldap/slapd.d in /var/backups/slapd-2.4.47+dfsg-3+deb10u4... done.
  Moving old database directory to /var/backups:
  - directory unknown... done.
  Creating initial configuration... done.
  Creating LDAP directory... done.

root@freston:~#
</pre>

<p>Si hacemos uso del comando <code>slapcat</code> nos mostraría, en formato <strong>LDIF</strong>, un volcado en bruto de los objetos que tiene ahora mismo el <em>servidor LDAP</em>:</p>
<pre>
root@freston:~# slapcat
dn: dc=javierpzh,dc=gonzalonazareno,dc=org
objectClass: top
objectClass: dcObject
objectClass: organization
o: javierpzh.gonzalonazareno.org
dc: javierpzh
structuralObjectClass: organization
entryUUID: 138073ec-d23b-103a-9a84-cf984c8cb121
creatorsName: cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org
createTimestamp: 20201214093249Z
entryCSN: 20201214093249.630601Z#000000#000#000000
modifiersName: cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org
modifyTimestamp: 20201214093249Z

dn: cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org
objectClass: simpleSecurityObject
objectClass: organizationalRole
cn: admin
description: LDAP administrator
userPassword:: e1NTSEF9NVFZcjVrK25sMFlEWVhmbHB1MEhETG9YRTVVZEhpU0U=
structuralObjectClass: organizationalRole
entryUUID: 138393ce-d23b-103a-9a85-cf984c8cb121
creatorsName: cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org
createTimestamp: 20201214093249Z
entryCSN: 20201214093249.651148Z#000000#000#000000
modifiersName: cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org
modifyTimestamp: 20201214093249Z
</pre>

<p>Por último, vamos a crear dos unidades organizativas, una destinada a las <strong>Personas</strong> y otra para <strong>Grupos</strong>.</p>
<p>Para esto, he creado un fichero <code>.ldif</code> llamado <code>unidadesorganizativas.ldif</code> que posee este aspecto:</p>
<pre>
dn: ou=Personas,dc=javierpzh,dc=gonzalonazareno,dc=org
objectClass: top
objectClass: organizationalUnit
ou: Personas

dn: ou=Grupos,dc=javierpzh,dc=gonzalonazareno,dc=org
objectClass: top
objectClass: organizationalUnit
ou: Grupos
</pre>

<p>Para cargar la configuración de este nuevo fichero, debemos hacer uso del siguiente comando:</p>
<pre>
ldapadd -x -D 'cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org' -W -f unidadesorganizativas.ldif
</pre>

<p>Aquí vemos el proceso:</p>
<pre>
root@freston:~# ldapadd -x -D 'cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org' -W -f unidadesorganizativas.ldif
Enter LDAP Password:
adding new entry "ou=Personas,dc=javierpzh,dc=gonzalonazareno,dc=org"

adding new entry "ou=Grupos,dc=javierpzh,dc=gonzalonazareno,dc=org"
</pre>

<p>Podemos ver como nos pide introducir la contraseña del administrador, y una vez la hayamos introducido, veremos dos líneas como mensaje de la creación de estas nuevas unidades organizativas.</p>
<p>Si ahora volvemos a hacer uso del comando <code>slapcat</code>:</p>
<pre>
root@freston:~# slapcat
dn: dc=javierpzh,dc=gonzalonazareno,dc=org
objectClass: top
objectClass: dcObject
objectClass: organization
o: javierpzh.gonzalonazareno.org
dc: javierpzh
structuralObjectClass: organization
entryUUID: 138073ec-d23b-103a-9a84-cf984c8cb121
creatorsName: cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org
createTimestamp: 20201214093249Z
entryCSN: 20201214093249.630601Z#000000#000#000000
modifiersName: cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org
modifyTimestamp: 20201214093249Z

dn: cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org
objectClass: simpleSecurityObject
objectClass: organizationalRole
cn: admin
description: LDAP administrator
userPassword:: e1NTSEF9NVFZcjVrK25sMFlEWVhmbHB1MEhETG9YRTVVZEhpU0U=
structuralObjectClass: organizationalRole
entryUUID: 138393ce-d23b-103a-9a85-cf984c8cb121
creatorsName: cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org
createTimestamp: 20201214093249Z
entryCSN: 20201214093249.651148Z#000000#000#000000
modifiersName: cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org
modifyTimestamp: 20201214093249Z

dn: ou=Personas,dc=javierpzh,dc=gonzalonazareno,dc=org
objectClass: top
objectClass: organizationalUnit
ou: Personas
structuralObjectClass: organizationalUnit
entryUUID: 3d9e1f28-d23e-103a-83fb-cbbecae82d26
creatorsName: cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org
createTimestamp: 20201214095528Z
entryCSN: 20201214095528.779588Z#000000#000#000000
modifiersName: cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org
modifyTimestamp: 20201214095528Z

dn: ou=Grupos,dc=javierpzh,dc=gonzalonazareno,dc=org
objectClass: top
objectClass: organizationalUnit
ou: Grupos
structuralObjectClass: organizationalUnit
entryUUID: 3da4c88c-d23e-103a-83fc-cbbecae82d26
creatorsName: cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org
createTimestamp: 20201214095528Z
entryCSN: 20201214095528.823265Z#000000#000#000000
modifiersName: cn=admin,dc=javierpzh,dc=gonzalonazareno,dc=org
modifyTimestamp: 20201214095528Z
</pre>

<p>En la salida del comando, podemos apreciar como se han creado estos dos nuevos objetos <strong>Personas</strong> y <strong>Grupos</strong>.</p>
    </article>

        <div class="tags">
            <p><strong><a href="/tags">tags:</a></strong> <a href="/tag/ldap.html">LDAP</a>, <a href="/tag/openstack.html">OpenStack</a></p>
        </div>

    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://www.instagram.com/javierpzh/">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://twitter.com/jperezhid_">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/javierpzh">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.facebook.com/javier.perezhidalgo.904">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="mailto:javierperezhidalgo01@gmail.com">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-envelope-square fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog creado por <a href="http://www.instagram.com/javierpzh/">Javier Pérez Hidalgo</a>,
    con la utilización de <a href="https://blog.getpelican.com/">Pelican</a>. <br />        &copy;  Javier Pérez Hidalgo
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/theme/js/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="/theme/js/clean-blog.min.js"></script>

</body>

</html>