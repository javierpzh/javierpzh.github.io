<!DOCTYPE html>
<html lang="es">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <title>Mapear URL a ubicaciones de un sistema de ficheros | Javier Pérez Hidalgo</title>

        <!-- Bootstrap Core CSS -->
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="/theme/css/code_blocks/darkly.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="Alias: Un alias me permite servir ficheros que no se encuentran en el DocumentRoot. Options: Determina para que sirven las siguientes...">

        <meta name="author" content="Javier Pérez Hidalgo">

        <meta name="tags" content="mapear">
        <meta name="tags" content="web">
        <meta name="tags" content="Apache">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="Javier Pérez Hidalgo">

	<meta property="og:type" content="article">
            <meta property="article:author" content="/author/javier-perez-hidalgo.html">
	<meta property="og:url" content="/mapear-url-a-ubicaciones-de-un-sistema-de-ficheros.html">
	<meta property="og:title" content="Mapear URL a ubicaciones de un sistema de ficheros">
	<meta property="article:published_time" content="2020-10-20 00:00:00+02:00">
            <meta property="og:description" content="Alias: Un alias me permite servir ficheros que no se encuentran en el DocumentRoot. Options: Determina para que sirven las siguientes...">

            <meta property="og:image" content="theme/images/banner-servicios.jpg">
    <link rel="icon" href="/images/favicon.ico">
</head>

<body class="article-mapear-url-a-ubicaciones-de-un-sistema-de-ficheros">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
        <!--    <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>-->
                <a class="navbar-brand" href="/">Inicio</a>
                <a class="navbar-brand" href="/categories">Categorías</a>
                <a class="navbar-brand" href="/authors">Sobre mí</a>

            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/theme/images/banner-servicios.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Mapear URL a ubicaciones de un sistema de ficheros</h1>
                        <span class="meta">Publicado por
                                <a href="/author/javier-perez-hidalgo.html">Javier Pérez Hidalgo</a>
                             el mar 20 octubre 2020
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <ul>
<li>
<p><strong><a href="http://httpd.apache.org/docs/2.4/mod/mod_alias.html#alias">Alias</a>: Un alias me permite servir ficheros que no se encuentran en el <code>DocumentRoot</code>.</strong></p>
</li>
<li>
<p><strong><a href="http://httpd.apache.org/docs/2.4/mod/core.html#options">Options</a>: Determina para que sirven las siguientes opciones de funcionamiento:</strong></p>
<ul>
<li>
<p><strong>All:</strong> habilita todas las opciones, menos <code>MultiViews</code>. Es la opción por defecto si no se indica ninguna opción.</p>
</li>
<li>
<p><strong>FollowSymLinks:</strong> sirve para seguir los enlaces simbólicos de un directorio.</p>
</li>
<li>
<p><strong>Indexes:</strong> sirve por si el cliente solicita un directorio en el que no exista ninguno de los ficheros especificados en <code>DirectoryIndex</code>, el servidor ofrecerá un listado de los archivos del directorio.</p>
</li>
<li>
<p><strong>MultiViews:</strong> permite mostrar una página distinta en función del idioma del navegador.</p>
</li>
<li>
<p><strong>SymLinksIfOwnerMatch:</strong> sirve para que el servidor siga los enlaces simbólicos en los que el fichero o directorio final pertenezca al mismo usuario que el propio enlace.</p>
</li>
<li>
<p><strong>ExecCGI:</strong> permite la ejecución de aplicaciones CGI en el directorio.</p>
</li>
</ul>
<p><strong>Determina como funciona si delante de las opciones pongo el signo + o -.</strong></p>
<p>Si pones el signo <strong>+</strong> delante de una opción, habilitas su funcionamiento, pero ojo, estás añadiendo esta opción a las demás opciones que haya configuradas antes. Si pones el signo <strong>-</strong> deshabilitas una opción de las que en un principio estaban habilitadas.</p>
<p>Es decir, esto es interesante a la hora de establecer, por ejemplo, que opciones tiene un directorio hijo a diferencia de su padre.</p>
</li>
<li>
<p><strong>La directiva <a href="http://httpd.apache.org/docs/2.4/mod/mod_alias.html#redirect">Redirect</a> nos permite crear redirecciones temporaless o permanentes.</strong></p>
</li>
<li>
<p><strong>Con la directiva <code>ErrorDocument</code> se pueden crear <a href="http://httpd.apache.org/docs/2.4/custom-error.html">Respuestas de error personalizadas</a>. Todo esto se puede llevar a cabo en el fichero <code>/etc/apache2/conf-available/localized-error-pages.conf</code>.</strong></p>
</li>
</ul>
<h2>Ejercicios</h2>
<p><strong>Crea un nuevo host virtual que es accedido con el nombre <code>www.mapeo.com</code>, cuyo <code>DocumentRoot</code> sea <code>/srv/mapeo</code>.</strong></p>
<p>Antes de nada voy a decir que en mi caso voy a utilizar <a href="https://www.vagrantup.com/">Vagrant</a> y como software de virtualización <a href="https://www.virtualbox.org/">VirtualBox</a>.</p>
<p>En el archivo <strong>VagrantFile</strong>, debemos realizar una configuración para crear una red privada, mediante la cuál poder visualizar los sitios webs fuera de la máquina virtual. Yo he utilizado esta configuración:</p>
<pre>
config.vm.network "private_network", ip: "192.168.33.10"
</pre>

<p>En esta máquina virtual, nos dirigimos al fichero de configuración de apache, <code>/etc/apache2/apache2.conf</code>, y debemos asegurarnos que tenemos descomentadas las siguientes líneas, que por defecto vienen comentadas:</p>
<pre>
<\Directory /srv/>
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
<\/Directory>
</pre>

<p>Esto indica que mostrará todos los ficheros de las páginas alojadas en la ruta <code>/srv/</code> y sus hijos.</p>
<p>En la ruta <code>/etc/apache2/sites-available/</code> creamos un fichero de configuración para esta página. Podemos copiar el fichero llamado <code>000-default.conf</code> para tener la estructura y luego lo modificamos:</p>
<pre>
cp 000-default.conf mapeo.conf
nano mapeo.conf
</pre>

<p>Y dentro de este fichero, establecemos la url de la web en el apartado <strong>ServerName</strong>, e indicamos en la línea <strong>DocumentRoot</strong>, que se encuentra en <code>/srv/mapeo</code>. Tiene que quedar así:</p>
<pre>
ServerName www.mapeo.com
DocumentRoot /svr/mapeo
</pre>

<p>Y creamos el enlace simbólico para activar el sitio web:</p>
<pre>
a2ensite mapeo.conf
</pre>

<p>Por último para visualizar este sitio web, en nuestro ordenador principal, deberíamos añadir a nuestro <code>/etc/hosts</code> la siguiente línea:</p>
<pre>
192.168.33.10   www.mapeo.com
</pre>

<p>Y ya podríamos ver la página web.</p>
<p><strong>1. Cuando se entre a la dirección <code>www.mapeo.com</code>, se redireccionará automáticamente a <code>www.mapeo.com/principal</code>, donde se mostrará el mensaje de bienvenida.</strong></p>
<p>Para automatizar una redirección, debemos configurarla en el archivo de configuración de la página, en este caso, se encuentra en <code>/etc/apache2/sites-available/mapeo.conf</code>.</p>
<p>Debemos introducir la siguiente línea:</p>
<pre>
Redirect /index.html /principal
</pre>

<p>Lo que indicamos con esta opción es que al introducir la ruta <code>/index.html</code> que es la que se introduce por defecto cuando accedemos a <code>www.mapeo.com</code>, nos salte a la ruta <code>/principal</code>, que contendrá otro <code>index.html</code>.</p>
<p>¿Te preguntarás porque he especificado <code>/index.html</code> en vez de <code>/</code> que suele ser lo más habitual, no? Pues bien, si pruebas esta opción introduciendo como url de origen <code>/</code> verás que te redirige a un bucle infinito que tendría como resultado una ruta como esta <code>www.mapeo.com/principalprincipalprincipal ...</code>.</p>
<p>Después reiniciamos el servicio:</p>
<pre>
systemctl restart apache2
</pre>

<p>Si ahora, accedemos a <code>www.mapeo.com</code>, automáticamente nos redirige y nos muestra la página <code>www.mapeo.com/principal</code>.</p>
<p><strong>2. En el directorio <code>principal</code> no se permite ver la lista de los ficheros, no se permite que se siga los enlaces simbólicos y no se permite negociación de contenido. Muestra al profesor el funcionamiento. ¿Qué configuración tienes que poner?</strong></p>
<p>Para ver la lista de ficheros de una dirección, cuando no se encuentre una archivo <code>index.html</code>, hay que añadir la opción <strong>Indexes</strong> al fichero de configuración de la página.</p>
<p>Antes vamos a renombrar el <code>index.html</code> para que no lo encuentre y nos muestre esta lista. Además voy a crear unos ficheros para que nos los muestre:</p>
<pre>
root@buster:/srv/mapeo/principal# mv index.html index.old

root@buster:/srv/mapeo/principal# touch 1 2 3

root@buster:/srv/mapeo/principal# ls
1  2  3  index.old
</pre>

<p>Ya podemos añadir la opción <strong>Indexes</strong> a nuestro <code>mapeo.conf</code>. Tenemos que añadir un bloque como el siguiente:</p>
<pre>
<\Directory /srv/mapeo>
  Options Indexes
  AllowOverride None
  Require all granted
<\/Directory>
</pre>

<p>Lo que estamos configurando aquí es que el directorio <code>/srv/mapeo</code> y sus hijos, si no encuentran el <code>index.html</code>, muestren la lista de archivos del directorio en el que se encuentre.</p>
<p>Reiniciamos el servicio:</p>
<pre>
systemctl restart apache2
</pre>

<p>Si accedemos a <code>www.mapeo.com</code> (que nos redirige a <code>www.mapeo.com/principal</code>), nos muestra esta salida del sitio web.</p>
<p><img alt="." src="images/sri_mapear_url_a_ubicaciones_de_un_sistema_de_ficheros/indexes.png"></p>
<p>Podemos acceder e inspeccionar el contenido de los archivos:</p>
<p><img alt="." src="images/sri_mapear_url_a_ubicaciones_de_un_sistema_de_ficheros/fichero1.png"></p>
<p><strong>3. Si accedes a la página <code>www.mapeo.com/principal/documentos</code> se visualizarán los documentos que hay en <code>/home/usuario/doc</code>. Por lo tanto se permitirá el listado de fichero y el seguimiento de enlaces simbólicos siempre que el propietario del enlace y del fichero al que apunta sean el mismo usuario. Explica bien y pon una prueba de funcionamiento donde se vea bien el seguimiento de los enlaces simbólicos.</strong></p>
<p>Lo primero que debemos hacer es crear un enlace simbólico a la carpeta <code>Documents</code> con el nombre <strong>documentos</strong>. Para ello:</p>
<pre>
root@buster:/srv/mapeo/principal# ln -s /home/vagrant/Documents/ documentos

root@buster:/srv/mapeo/principal# ls -l
total 8
-rw-r--r-- 1 root root  19 Oct 21 15:41 1
-rw-r--r-- 1 root root   0 Oct 21 15:15 2
-rw-r--r-- 1 root root   0 Oct 21 15:15 3
lrwxrwxrwx 1 root root  32 Oct 21 16:13 documentos -> /home/vagrant/Documents/
-rw-r--r-- 1 root root 159 Oct 21 14:39 index.old
</pre>

<p>Vemos como nos ha creado el enlace simbólico, que apunta a la carpeta <code>/home/vagrant/Documents/</code>, cuyo propietario es <strong>root</strong>, que esto es muy importante, ya que el propietario del enlace simbólico y del archivo/directorio al que haga referencia tienen que ser el mismo.</p>
<p>Ahora creo un par de ficheros y una carpeta dentro de <code>Documents</code>:</p>
<pre>
root@buster:/home/vagrant/Documents# touch ejemplo1 ejemplo2

root@buster:/home/vagrant/Documents# mkdir ejemplo

root@buster:/home/vagrant/Documents# ls
ejemplo  ejemplo1  ejemplo2
</pre>

<p>El propietario de la carpeta <code>Documents</code> es <strong>vagrant</strong>, y como he comentado antes, tiene que ser el mismo propietario que el enlace simbólico, por tanto, voy a cambiar el propietario de este directorio:</p>
<pre>
vagrant@buster:~$ sudo chown root:root Documents/

vagrant@buster:~$ ls -l
total 32
drwxr-xr-x 2 vagrant vagrant 4096 Oct 13 12:31 Desktop
drwxr-xr-x 3 root    root    4096 Oct 21 16:05 Documents
drwxr-xr-x 2 vagrant vagrant 4096 Oct 13 12:31 Downloads
drwxr-xr-x 2 vagrant vagrant 4096 Oct 13 12:31 Music
drwxr-xr-x 2 vagrant vagrant 4096 Oct 13 12:31 Pictures
drwxr-xr-x 2 vagrant vagrant 4096 Oct 13 12:31 Public
drwxr-xr-x 2 vagrant vagrant 4096 Oct 13 12:31 Templates
drwxr-xr-x 2 vagrant vagrant 4096 Oct 13 12:31 Videos
</pre>

<p>Vemos como hemos cambiado el propietario de la carpeta, y en este punto solo nos quedaría añadir la opción <strong>SymLinksIfOwnerMatch</strong> al fichero de configuración de la web:</p>
<pre>
<\Directory /srv/mapeo>
  Options Indexes SymLinksIfOwnerMatch
  AllowOverride None
  Require all granted
<\/Directory>
</pre>

<p>Si accedemos a <code>www.mapeo.com</code> (que nos redirige a <code>www.mapeo.com/principal</code>), nos muestra esta salida del sitio web.</p>
<p><img alt="." src="images/sri_mapear_url_a_ubicaciones_de_un_sistema_de_ficheros/ejercicio3.png"></p>
<p>Vemos que nos muestra un directorio <code>documentos</code>, y si accedemos a él:</p>
<p><img alt="." src="images/sri_mapear_url_a_ubicaciones_de_un_sistema_de_ficheros/documentos.png"></p>
<p>Observamos que tenemos acceso a él y a sus archivos.</p>
<p><strong>4. En todo el host virtual se debe redefinir los mensajes de error de objeto no encontrado y no permitido. Para ello se crearán dos ficheros html dentro del directorio error. Entrega las modificaciones necesarias en la configuración y una comprobación del buen funcionamiento.</strong></p>
<p>Creamos la carpeta <code>error</code> dentro del directorio <code>mapeo</code>, y creamos los archivos html, en este caso <code>403.html</code> y <code>404.html</code>.</p>
<pre>
root@buster:/srv/mapeo# mkdir error

root@buster:/srv/mapeo# cd error/

root@buster:/srv/mapeo/error# nano 403.html

root@buster:/srv/mapeo/error# nano 404.html

root@buster:/srv/mapeo/error# ls
403.html  404.html
</pre>

<p>Nos movemos al fichero de configuración de la web y añadimos las siguientes líneas:</p>
<pre>
ErrorDocument 404 /error/404.html
ErrorDocument 403 /error/403.html
</pre>

<p>Reiniciamos el servicio:</p>
<pre>
systemctl restart apache2
</pre>

<p>Si introducimos una ruta que no existe, nos sale este error 404:</p>
<p><img alt="." src="images/sri_mapear_url_a_ubicaciones_de_un_sistema_de_ficheros/noexiste.png"></p>
<p>Vemos que sale el archivo html que hemos configurado para este error. Para el error 403, es decir, cuando intentamos acceder a una ruta a la que no tenemos permisos suficientes:</p>
<p><img alt="." src="images/sri_mapear_url_a_ubicaciones_de_un_sistema_de_ficheros/sinpermiso.png"></p>
<p>Nos muestra este error.</p>
    </article>

        <div class="tags">
            <p><strong><a href="/tags">tags:</a></strong> <a href="/tag/mapear.html">mapear</a>, <a href="/tag/web.html">web</a>, <a href="/tag/apache.html">Apache</a></p>
        </div>

    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://www.instagram.com/javierpzh/">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://twitter.com/jperezhid_">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/javierpzh">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.facebook.com/javier.perezhidalgo.904">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="mailto:javierperezhidalgo01@gmail.com">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-envelope-square fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog creado por <a href="http://www.instagram.com/javierpzh/">Javier Pérez Hidalgo</a>,
    con la utilización de <a href="https://blog.getpelican.com/">Pelican</a>. <br />        &copy;  Javier Pérez Hidalgo
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/theme/js/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="/theme/js/clean-blog.min.js"></script>

</body>

</html>