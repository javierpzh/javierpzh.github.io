<!DOCTYPE html>
<html lang="es">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <title>VirtualHosting con Apache | Javier Pérez Hidalgo</title>

        <!-- Bootstrap Core CSS -->
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="/theme/css/code_blocks/darkly.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="Configuración de VirtualHosting Antes de nada voy a decir que en mi caso voy a utilizar Vagrant y como software de virtualización...">

        <meta name="author" content="Javier Pérez Hidalgo">

        <meta name="tags" content="virtualhosting">
        <meta name="tags" content="Apache">
        <meta name="tags" content="web">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="Javier Pérez Hidalgo">

	<meta property="og:type" content="article">
            <meta property="article:author" content="/author/javier-perez-hidalgo.html">
	<meta property="og:url" content="/virtualhosting-con-apache.html">
	<meta property="og:title" content="VirtualHosting con Apache">
	<meta property="article:published_time" content="2020-10-14 00:00:00+02:00">
            <meta property="og:description" content="Configuración de VirtualHosting Antes de nada voy a decir que en mi caso voy a utilizar Vagrant y como software de virtualización...">

            <meta property="og:image" content="theme/images/banner-servicios.jpg">
    <link rel="icon" href="/images/favicon.ico">
</head>

<body class="article-virtualhosting-con-apache">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
        <!--    <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>-->
                <a class="navbar-brand" href="/">Inicio</a>
                <a class="navbar-brand" href="/categories">Categorías</a>
                <a class="navbar-brand" href="/authors">Sobre mí</a>

            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/theme/images/banner-servicios.jpg')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>VirtualHosting con Apache</h1>
                        <span class="meta">Publicado por
                                <a href="/author/javier-perez-hidalgo.html">Javier Pérez Hidalgo</a>
                             el mié 14 octubre 2020
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <h2>Configuración de VirtualHosting</h2>
<p>Antes de nada voy a decir que en mi caso voy a utilizar <a href="https://www.vagrantup.com/">Vagrant</a> y como software de virtualización <a href="https://www.virtualbox.org/">VirtualBox</a>.</p>
<p>El objetivo de esta práctica es la puesta en marcha de dos sitios web utilizando el mismo servidor web apache. Hay que tener en cuenta lo siguiente:</p>
<ul>
<li>Cada sitio web tendrá nombres distintos.</li>
<li>Cada sitio web compartirán la misma dirección IP y el mismo puerto (80).</li>
</ul>
<p>Queremos construir en nuestro servidor web apache dos sitios web con las siguientes características:</p>
<ul>
<li>El nombre de dominio del primero será <code>www.iesgn.org</code>, su directorio base será <code>/var/www/iesgn</code> y contendrá una página llamada <code>index.html</code>, donde sólo se verá una bienvenida a la página del Instituto Gonzalo Nazareno.</li>
<li>En el segundo sitio vamos a crear una página donde se pondrán noticias por parte de los departamento, el nombre de este sitio será <code>www.departamentosgn.org</code>, y su directorio base será <code>/var/www/departamentos</code>. En este sitio sólo tendremos una página inicial <code>index.html</code>, dando la bienvenida a la página de los departamentos del instituto.</li>
</ul>
<p>Para conseguir estos dos sitios virtuales debes seguir los siguientes pasos:</p>
<p><strong>1. Los ficheros de configuración de los sitios webs se encuentran en el directorio <code>/etc/apache2/sites-available</code>, por defecto hay dos ficheros, uno se llama <code>000-default.conf</code> que es la configuración del sitio web por defecto. Necesitamos tener dos ficheros para realizar la configuración de los dos sitios virtuales, para ello vamos a copiar el fichero <code>000-default.conf</code>:</strong></p>
<pre>
cd /etc/apache2/sites-available
cp 000-default.conf iesgn.conf
cp 000-default.conf departamentos.conf
</pre>

<p>De esta manera tendremos un fichero llamado <code>iesgn.conf</code> para realizar la configuración del sitio web <code>www.iesgn.org</code>, y otro llamado <code>departamentos.conf</code> para el sitio web <code>www.departamentosgn.org</code>.</p>
<p><strong>2. Modificamos los ficheros <code>iesgn.conf</code> y <code>departamentos.conf</code>, para indicar el nombre que vamos a usar para acceder al host virtual <code>(ServerName)</code> y el directorio de trabajo (<code>DocumentRoot</code>).</strong></p>
<p>Cambiamos las líneas de ServerName y DocumentRoot de forma que queden así:</p>
<p>Para la página <code>www.iesgn.org</code>:</p>
<pre>
ServerName www.iesgn.org
DocumentRoot /var/www/iesgn
</pre>

<p>Para <code>www.departamentosgn.org</code>:</p>
<pre>
ServerName www.departamentosgn.org
DocumentRoot /var/www/departamentos
</pre>

<p><strong>3. No es suficiente crear los ficheros de configuración de cada sitio web, es necesario crear un enlace simbólico a estos ficheros dentro del directorio <code>/etc/apache2/sites-enabled</code>, para ello:</strong></p>
<pre>
a2ensite iesgn
a2ensite departamentos
</pre>

<p><strong>La creación de los enlaces simbólicos se puede hacer con la instrucción <code>a2ensite nombre_fichero_configuracion</code>, para deshabilitar el sitio tenemos que borrar el enlace simbólico o usar la instrucción <code>a2dissite nombre_fichero_configuracion</code>.</strong></p>
<pre>
a2ensite iesgn.conf
a2ensite departamentos.conf
</pre>

<p><strong>4. Crea los directorios y los ficheros 'index.html' necesarios en <code>/var/www</code> y reiniciamos el servicio.</strong></p>
<pre>
root@buster:/var/www# cat iesgn/index.html
<\html>
    <\head>
        <\title>INICIO IESGN<\/title>
        <\/head>
        <\body>
               <\h1>Inicio<\/h1>
             <\p>Pagina del Gonzalo Nazareno.<\/p>
    <\/body>
<\/html>

root@buster:/var/www# cat departamentos/index.html
<\html>
    <\head>
        <\title>DEPARTAMENTOS IESGN<\/title>
        <\/head>
        <\body>
               <\h1>Departamentos<\/h1>
             <\p>Departamentos del Gonzalo Nazareno.<\/p>
         <\ul>Seguridad<\/ul>
         <\ul>Servicios<\/ul>
    <\/body>
<\/html>
</pre>

<p>Para reiniciar el servicio:</p>
<pre>
systemctl restart apache2.service
</pre>

<p><strong>5. Para terminar lo único que tendremos que hacer es cambiar el fichero hosts en los clientes y poner dos nuevas líneas donde se haga la conversión entre los dos nombre de dominio y la dirección IP del servidor.</strong></p>
<p>Hay que decir que si queremos visualizar las dos páginas webs en nuestro cliente, debemos configurar una red privada.</p>
<p>Para crear una red <code>hostonly</code>, podemos simplemente descomentar la siguiente línea que viene comentada por defecto en el fichero 'Vagrantfile'. Esto asignará un IP privada fija a nuestra mv.</p>
<pre>
config.vm.network "private_network", ip: "192.168.33.10"
</pre>

<p>Luego en el fichero <code>/etc/hosts</code> del cliente, añadir estas dos líneas:</p>
<pre>
192.168.33.10    www.iesgn.org
192.168.33.10    www.departamentosgn.org
</pre>

<p>La IP obviamente depende de la cual tengamos asignada a la mv.</p>
<p>Voy a abrir las páginas desde el cliente.</p>
<p><img alt="." src="images/sri_virtualhosting_apache/iesgn_web.png"></p>
<p><img alt="." src="images/sri_virtualhosting_apache/departamentos_web.png"></p>
<p><strong>Repite el ejercicio cambiando los directorios de trabajo a <code>/srv/www</code>. ¿Qué modificación debes hacer en el fichero <code>/etc/apache2/apache2.conf</code>?</strong></p>
<p>Lo primero que debemos hacer es modificar el fichero <code>apache2.conf</code>, que actualmente posee esta configuración:</p>
<pre>
<\Directory /var/www/>
        Options Indexes FollowSymLinks
        AllowOverride None
        Require all granted
<\/Directory>

#<\Directory /srv/>
#       Options Indexes FollowSymLinks
#       AllowOverride None
#       Require all granted
#<\/Directory>
</pre>

<p>Esto indica que mostrará todos los ficheros de las páginas alojadas en la ruta <code>/var/www/</code>. Lo que debemos hacer es comentar estas líneas y descomentar las de abajo que hacen referencia a la ruta <code>/srv/</code> y todos sus hijos:</p>
<pre>
#<\Directory /var/www/>
#        Options Indexes FollowSymLinks
#        AllowOverride None
#        Require all granted
#<\/Directory>

<\Directory /srv/>
       Options Indexes FollowSymLinks
       AllowOverride None
       Require all granted
<\/Directory>
</pre>

<p>Ahora creamos la estructura de directorios que queremos y copiamos los mismos 'index.html' que hemos utilizado antes:
<pre>
cd /var/www/iesgn
cp index.html /srv/www/iesgn/
cd ../departamentos/
cp index.html /srv/www/departamentos/
</pre></p>
<p>Ahora ya solo nos quedaría modificar los archivos <code>iesgn.conf</code> y <code>departamentos.conf</code> que se encuentran en el directorio <code>/etc/apache2/sites-available</code>. En mi caso he utilizado los mismos ficheros de configuración que había generado antes, por tanto solo tendría que cambiar la ruta del 'DocumentRoot', pero también se podrían generar otros archivos de configuración, si deseamos conservar estos:</p>
<p>La línea del fichero <code>iesgn.conf</code> quedaría:</p>
<pre>
DocumentRoot /srv/www/iesgn
</pre>

<p>Y la del <code>departamentos.conf</code>:</p>
<pre>
DocumentRoot /srv/www/departamentos
</pre>

<p>Ahora reiniciamos el servicio:</p>
<pre>
systemctl restart apache2.service
</pre>

<p>Y ya podríamos ver las páginas alojadas en nuestro directorio <code>/srv/</code>.</p>
    </article>

        <div class="tags">
            <p><strong><a href="/tags">tags:</a></strong> <a href="/tag/virtualhosting.html">virtualhosting</a>, <a href="/tag/apache.html">Apache</a>, <a href="/tag/web.html">web</a></p>
        </div>

    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://www.instagram.com/javierpzh/">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://twitter.com/jperezhid_">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/javierpzh">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.facebook.com/javier.perezhidalgo.904">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="mailto:javierperezhidalgo01@gmail.com">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-envelope-square fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog creado por <a href="http://www.instagram.com/javierpzh/">Javier Pérez Hidalgo</a>,
    con la utilización de <a href="https://blog.getpelican.com/">Pelican</a>. <br />        &copy;  Javier Pérez Hidalgo
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/theme/js/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="/theme/js/clean-blog.min.js"></script>

</body>

</html>