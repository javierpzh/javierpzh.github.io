<!DOCTYPE html>
<html lang="es">

<head>
            <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">


        <title>Interconexiones de Servidores de bases de datos | Javier Pérez Hidalgo</title>

        <!-- Bootstrap Core CSS -->
        <link href="/theme/css/bootstrap.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="/theme/css/clean-blog.min.css" rel="stylesheet">

        <!-- Code highlight color scheme -->
            <link href="/theme/css/code_blocks/darkly.css" rel="stylesheet">


        <!-- Custom Fonts -->
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
        <link href='https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
        <link href='https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->



        <meta name="description" content="Las interconexiones de servidores de bases de datos son operaciones que pueden ser muy útiles en diferentes contextos. Básicamente, se...">

        <meta name="author" content="Javier Pérez Hidalgo">

        <meta name="tags" content="Base de Datos">
        <meta name="tags" content="Oracle">
        <meta name="tags" content="MySQL">
        <meta name="tags" content="MariaDB">
        <meta name="tags" content="PostgreSQL">

	                <meta property="og:locale" content="">
		<meta property="og:site_name" content="Javier Pérez Hidalgo">

	<meta property="og:type" content="article">
            <meta property="article:author" content="/author/javier-perez-hidalgo.html">
	<meta property="og:url" content="/interconexiones-de-servidores-de-bases-de-datos.html">
	<meta property="og:title" content="Interconexiones de Servidores de bases de datos">
	<meta property="article:published_time" content="2018-02-05 00:00:00+01:00">
            <meta property="og:description" content="Las interconexiones de servidores de bases de datos son operaciones que pueden ser muy útiles en diferentes contextos. Básicamente, se...">

            <meta property="og:image" content="theme/images/banner-basededatos.png">
</head>

<body class="article-interconexiones-de-servidores-de-bases-de-datos">

    <!-- Navigation -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
        <!--    <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>-->
                <a class="navbar-brand" href="/">Inicio</a>
                <a class="navbar-brand" href="/categories">Categorías</a>
                <a class="navbar-brand" href="/authors">Sobre mí</a>

            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">

                </ul>
            </div>
            <!-- /.navbar-collapse -->
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Header -->
        <header class="intro-header" style="background-image: url('/theme/images/banner-basededatos.png')">
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <div class="post-heading">
                        <h1>Interconexiones de Servidores de bases de datos</h1>
                        <span class="meta">Publicado por
                                <a href="/author/javier-perez-hidalgo.html">Javier Pérez Hidalgo</a>
                             el lun 05 febrero 2018
                        </span>
                        
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
    <!-- Post Content -->
    <article>
        <p><strong>Las interconexiones de servidores de bases de datos son operaciones que pueden ser muy útiles en diferentes contextos. Básicamente, se trata de acceder a datos que no están almacenados en nuestra base de datos, pudiendo combinarlos con los que ya tenemos.</strong></p>
<p><strong>En este artículo veremos varias formas de crear un enlace entre distintos servidores de bases de datos. Los servidores enlazados siempre estarán instalados en máquinas diferentes.</strong></p>
<p><strong>Hay que decir que trabajaré sobre los escenarios creados en el <em>post</em> anterior, que trataba sobre <a href="https://javierpzh.github.io/instalacion-de-servidores-y-clientes-de-bases-de-datos.html">Instalación de Servidores y Clientes de bases de datos</a>, por lo que ya dispongo de los servidores instalados y con las configuraciones básicas.</strong></p>
<h4>Enlace entre dos servidores de bases de datos ORACLE</h4>
<p>En este primer caso, vamos a ver que configuraciones son necesarias para enlazar dos servidores <strong>Oracles</strong>.</p>
<p>Nos situamos en la primera de las máquinas, que recordemos que recibe el nombre de <strong>servidor</strong>.</p>
<p>Nos dirigiremos a los ficheros <code>listener.ora</code> y <code>tnsnames.ora</code>, ambos se encuentran en la ruta <code>$ORACLE_HOME/network/admin</code>, ya que en ellos es donde realizaremos la configuración.</p>
<p>Primeramente, para habilitar el acceso remoto al servidor, debemos modificar el fichero <code>listener.ora</code>. Por defecto, posee este aspecto:</p>
<pre>
SID_LIST_LISTENER =
  (SID_LIST =
    (SID_DESC =
      (SID_NAME = CLRExtProc)
      (ORACLE_HOME = C:\Users\servidor\Desktop\WINDOWS.X64_193000_db_home)
      (PROGRAM = extproc)
      (ENVS = "EXTPROC_DLLS=ONLY:C:\Users\servidor\Desktop\WINDOWS.X64_193000_db_home\bin\oraclr19.dll")
    )
  )

LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
  )
</pre>

<p>Si nos fijamos, dentro del bloque <strong>LISTENER</strong>, en la línea que define la regla para el protocolo TCP, que es la que nos interesa, podemos ver que en el campo <strong>HOST</strong> está configurado para que solo escuche las peticiones cuyo origen es <strong>localhost</strong>. También está configurado para que el puerto por el que escuche sea el <strong>1521</strong>, que es el que viene configurado por defecto, a mí me vale, por eso lo dejo. Obviamente lo que hay que cambiar es el valor del campo <strong>HOST</strong>, y establecerle como valor la interfaz desde la que queremos escuchar las peticiones. En mi caso, voy a especificar el <strong>nombre de mi máquina</strong> para que así escuche todas las peticiones.</p>
<pre>
SID_LIST_LISTENER =
  (SID_LIST =
    (SID_DESC =
      (SID_NAME = CLRExtProc)
      (ORACLE_HOME = C:\Users\servidor\Desktop\WINDOWS.X64_193000_db_home)
      (PROGRAM = extproc)
      (ENVS = "EXTPROC_DLLS=ONLY:C:\Users\servidor\Desktop\WINDOWS.X64_193000_db_home\bin\oraclr19.dll")
    )
  )

LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = DESKTOP-IGG1O7P)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
  )
</pre>

<p>Una vez hemos realizado este cambio, podemos iniciar el listener. El listener se maneja con estos comandos:</p>
<ul>
<li><strong>lsnrctl start:</strong> inicia el servicio.</li>
<li><strong>lsnrctl stop:</strong> detiene el servicio.</li>
<li><strong>lsnrctl status:</strong> muestra información sobre el estado.</li>
</ul>
<p>Lo iniciamos:</p>
<pre>
C:\Windows\System32>lsnrctl start

LSNRCTL for 64-bit Windows: Version 19.0.0.0.0 - Production on 17-DIC-2020 14:07:48

Copyright (c) 1991, 2019, Oracle.  All rights reserved.

Iniciando tnslsnr: espere...

TNSLSNR for 64-bit Windows: Version 19.0.0.0.0 - Production
El archivo de parßmetros del sistema es C:\Users\javier\Desktop\WINDOWS.X64_193000_db_home\network\admin\listener.ora
Mensajes de log escritos en C:\Users\javier\Desktop\diag\tnslsnr\DESKTOP-IGG1O7P\listener\alert\log.xml
Recibiendo en: (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=DESKTOP-IGG1O7P)(PORT=1521)))
Recibiendo en: (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(PIPENAME=\\.\pipe\EXTPROC1521ipc)))

Conectßndose a (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=DESKTOP-IGG1O7P)(PORT=1521)))
ESTADO del LISTENER
------------------------
Alias                     LISTENER
Versi¾n                   TNSLSNR for 64-bit Windows: Version 19.0.0.0.0 - Production
Fecha de Inicio       28-ENE-2020 14:07:52
Tiempo Actividad   0 dÝas 0 hr. 0 min. 10 seg.
Nivel de Rastreo        off
Seguridad               ON: Local OS Authentication
SNMP                      OFF
Parßmetros del Listener   C:\Users\javier\Desktop\WINDOWS.X64_193000_db_home\network\admin\listener.ora
Log del Listener          C:\Users\javier\Desktop\diag\tnslsnr\DESKTOP-IGG1O7P\listener\alert\log.xml
Recibiendo Resumen de Puntos Finales...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=DESKTOP-IGG1O7P)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(PIPENAME=\\.\pipe\EXTPROC1521ipc)))
Resumen de Servicios...
El servicio "CLRExtProc" tiene 1 instancia(s).
  La instancia "CLRExtProc", con estado UNKNOWN, tiene 1 manejador(es) para este servicio...
El comando ha terminado correctamente
</pre>

<p>Vemos que lo ha iniciado correctamente. Ahora, para asegurarnos que realmente está escuchando peticiones desde el puerto 1521 vamos a utilizar el comando <code>netstat</code>:</p>
<pre>
C:\Users\servidor>netstat

Conexiones activas

  Proto  Dirección local        Dirección remota       Estado
  TCP    127.0.0.1:1521         DESKTOP-IGG1O7P:49692  ESTABLISHED
  TCP    127.0.0.1:49692        DESKTOP-IGG1O7P:1521   ESTABLISHED
  TCP    [fe80::c9ee:eb4d:5f0b:a64f%4]:49703  DESKTOP-IGG1O7P:1521   TIME_WAIT
</pre>

<p>Vemos que efectivamente está escuchando en dicho puerto.</p>
<p>Hecho esto, ya habríamos habilitado al servidor para que permita el acceso remoto, por tanto, vamos a dirigirnos al segundo y último fichero de configuración, el llamado <code>tnsnames.ora</code>, que por defecto posee esta configuración:</p>
<pre>
LISTENER_ORCL =
  (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))

ORACLR_CONNECTION_DATA =
  (DESCRIPTION =
    (ADDRESS_LIST =
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
    (CONNECT_DATA =
      (SID = CLRExtProc)
      (PRESENTATION = RO)
    )
  )

ORCL =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = localhost)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = orcl)
    )
  )
</pre>

<p>Editaremos el último bloque que definirá la conexión con el segundo servidor <em>Oracle</em>, quedando de esta manera:</p>
<pre>
ORCL =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.0.56)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = orcl)
    )
  )
</pre>

<p>Una vez modificado este fichero, debemos parar el proceso <strong>listener</strong> y volverlo a iniciar para que así se apliquen los nuevos cambios.</p>
<pre>
C:\Windows\system32>lsnrctl stop

LSNRCTL for 64-bit Windows: Version 19.0.0.0.0 - Production on 03-FEB-2021 17:53:36

Copyright (c) 1991, 2019, Oracle.  All rights reserved.

Conectßndose a (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=DESKTOP-IGG1O7P)(PORT=1521)))
El comando ha terminado correctamente

C:\Windows\system32>lsnrctl start

LSNRCTL for 64-bit Windows: Version 19.0.0.0.0 - Production on 03-FEB-2021 17:53:58

Copyright (c) 1991, 2019, Oracle.  All rights reserved.

Iniciando tnslsnr: espere...

TNSLSNR for 64-bit Windows: Version 19.0.0.0.0 - Production
El archivo de parßmetros del sistema es C:\Users\servidor\Desktop\WINDOWS.X64_193000_db_home\network\admin\listener.ora
Mensajes de log escritos en C:\Users\servidor\Desktop\diag\tnslsnr\DESKTOP-IGG1O7P\listener\alert\log.xml
Recibiendo en: (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=DESKTOP-IGG1O7P)(PORT=1521)))
Recibiendo en: (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(PIPENAME=\\.\pipe\EXTPROC1521ipc)))

Conectßndose a (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=DESKTOP-IGG1O7P)(PORT=1521)))
ESTADO del LISTENER
------------------------
Alias                     LISTENER
Versi¾n                   TNSLSNR for 64-bit Windows: Version 19.0.0.0.0 - Production
Fecha de Inicio       03-FEB-2021 17:54:02
Tiempo Actividad   0 dÝas 0 hr. 0 min. 10 seg.
Nivel de Rastreo        off
Seguridad               ON: Local OS Authentication
SNMP                      OFF
Parßmetros del Listener   C:\Users\servidor\Desktop\WINDOWS.X64_193000_db_home\network\admin\listener.ora
Log del Listener          C:\Users\servidor\Desktop\diag\tnslsnr\DESKTOP-IGG1O7P\listener\alert\log.xml
Recibiendo Resumen de Puntos Finales...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=DESKTOP-IGG1O7P)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(PIPENAME=\\.\pipe\EXTPROC1521ipc)))
Resumen de Servicios...
El servicio "CLRExtProc" tiene 1 instancia(s).
  La instancia "CLRExtProc", con estado UNKNOWN, tiene 1 manejador(es) para este servicio...
El comando ha terminado correctamente

C:\Windows\system32>
</pre>

<p>Bien, ahora debemos dirigirnos al segundo servidor, que es al que vamos a realizarle la consulta, y en su fichero <code>listener.ora</code>, habilitar el acceso remoto como hicimos anteriormente:</p>
<pre>
SID_LIST_LISTENER =
  (SID_LIST =
    (SID_DESC =
      (SID_NAME = CLRExtProc)
      (ORACLE_HOME = C:\Users\servidor\Desktop\WINDOWS.X64_193000_db_home)
      (PROGRAM = extproc)
      (ENVS = "EXTPROC_DLLS=ONLY:C:\Users\servidor\Desktop\WINDOWS.X64_193000_db_home\bin\oraclr19.dll")
    )
  )

LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = DESKTOP-IGG1O7P)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
  )
</pre>

<p>Cuando hayamos realizado la modificación, iniciaremos de nuevo el <strong>listener</strong> y aplicaremos los cambios:</p>
<pre>
C:\Windows\system32>lsnrctl start

LSNRCTL for 64-bit Windows: Version 19.0.0.0.0 - Production on 03-FEB-2021 18:02:49

Copyright (c) 1991, 2019, Oracle.  All rights reserved.

Iniciando tnslsnr: espere...

TNSLSNR for 64-bit Windows: Version 19.0.0.0.0 - Production
El archivo de parßmetros del sistema es C:\Users\servidor\Desktop\WINDOWS.X64_193000_db_home\network\admin\listener.ora
Mensajes de log escritos en C:\Users\servidor\Desktop\diag\tnslsnr\DESKTOP-IGG1O7P\listener\alert\log.xml
Recibiendo en: (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=DESKTOP-IGG1O7P)(PORT=1521)))
Recibiendo en: (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(PIPENAME=\\.\pipe\EXTPROC1521ipc)))

Conectßndose a (DESCRIPTION=(ADDRESS=(PROTOCOL=TCP)(HOST=DESKTOP-IGG1O7P)(PORT=1521)))
ESTADO del LISTENER
------------------------
Alias                     LISTENER
Versi¾n                   TNSLSNR for 64-bit Windows: Version 19.0.0.0.0 - Production
Fecha de Inicio       03-FEB-2021 18:02:55
Tiempo Actividad   0 dÝas 0 hr. 0 min. 12 seg.
Nivel de Rastreo        off
Seguridad               ON: Local OS Authentication
SNMP                      OFF
Parßmetros del Listener   C:\Users\servidor\Desktop\WINDOWS.X64_193000_db_home\network\admin\listener.ora
Log del Listener          C:\Users\servidor\Desktop\diag\tnslsnr\DESKTOP-IGG1O7P\listener\alert\log.xml
Recibiendo Resumen de Puntos Finales...
  (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=DESKTOP-IGG1O7P)(PORT=1521)))
  (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(PIPENAME=\\.\pipe\EXTPROC1521ipc)))
Resumen de Servicios...
El servicio "CLRExtProc" tiene 1 instancia(s).
  La instancia "CLRExtProc", con estado UNKNOWN, tiene 1 manejador(es) para este servicio...
El comando ha terminado correctamente
</pre>

<p>Cuando ya poseamos todas las configuraciones listas, vamos a proceder a crear la conexión entre los servidores.</p>
<p>Pero antes de esto, voy a crear un usuario y alguna tabla que poder consultar, ya que este servidor, es totalmente virgen, por decirlo de alguna forma:</p>
<pre>
C:\Windows\system32>sqlplus

SQL*Plus: Release 19.0.0.0.0 - Production on MiÚ Feb 3 18:06:19 2021
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

Introduzca el nombre de usuario: system
Introduzca la contrase±a:
Hora de ┌ltima Conexi¾n Correcta: Jue Ene 28 2021 18:56:11 +01:00

Conectado a:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0

SQL> CREATE USER c##javierserv2 IDENTIFIED BY contraseña;

Usuario creado.

SQL> GRANT ALL PRIVILEGES TO c##javierserv2;

Concesi¾n terminada correctamente.
</pre>

<p>Vamos a crear la tabla <strong>Marcas</strong>, que será la que consultaremos luego a partir de este <a href="images/abd_interconexiones_de_servidores_de_bases_de_datos/scriptoracle.txt">script</a>:</p>
<pre>
C:\Windows\system32>sqlplus

SQL*Plus: Release 19.0.0.0.0 - Production on MiÚ Feb 3 18:07:21 2021
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

Introduzca el nombre de usuario: c##javierserv2
Introduzca la contrase±a:

Conectado a:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0

SQL> create table Marcas
  2  (
  3  Codigo VARCHAR(6),
  4  Nombre VARCHAR(20),
  5  Sede VARCHAR(15),
  6  CONSTRAINT pk_Codigo PRIMARY KEY(Codigo)
  7  );

Tabla creada.

SQL> insert into Marcas(Codigo,Nombre,Sede) values ('000100','VeteCat','Barcelona');

1 fila creada.

SQL> insert into Marcas(Codigo,Nombre,Sede) values ('000200','Nike','Lisboa');

1 fila creada.

SQL> insert into Marcas(Codigo,Nombre,Sede) values ('000300','Danone','New York');

1 fila creada.

SQL> insert into Marcas(Codigo,Nombre,Sede) values ('000400','Samsung','Tokyo');

1 fila creada.

SQL> insert into Marcas(Codigo,Nombre,Sede) values ('000500','Zara','Berlin');

1 fila creada.
</pre>

<p>Ahora sí, vamos a crear el propio enlace.</p>
<p>Para ello nos dirigimos al primer servidor y con el usuario <strong>sys</strong>, crearemos el enlace hacia el segundo servidor.</p>
<p>La sintáxis para crear un enlace es la siguiente:</p>
<pre>
create database link linkserv2
connect to c##javierserv2
identified by contraseña
using 'orcl';
</pre>

<p>Vemos el resultado de la creación del enlace:</p>
<pre>
C:\Windows\system32>sqlplus

SQL*Plus: Release 19.0.0.0.0 - Production on MiÚ Feb 3 18:07:21 2021
Version 19.3.0.0.0

Copyright (c) 1982, 2019, Oracle.  All rights reserved.

Introduzca el nombre de usuario: system
Introduzca la contrase±a:
Hora de ┌ltima Conexi¾n Correcta: Mar Ene 19 2021 19:32:59 +01:00

Conectado a:
Oracle Database 19c Enterprise Edition Release 19.0.0.0.0 - Production
Version 19.3.0.0.0

SQL> create database link linkserv2
  2  connect to c##javierserv2
  3  identified by contraseña
  4  using 'orcl';

Enlace con la base de datos creado.
</pre>

<p>Vamos a probar a hacer una consulta desde el primer servidor a la tabla <strong>Marcas</strong> que acabamos de crear y se encuentra en el segundo servidor:</p>
<pre>
SQL> select * from marcas@linkserv2;

CODIGO NOMBRE               SEDE
------ -------------------- ---------------
000100 VeteCat              Barcelona
000200 Nike                 Lisboa
000300 Danone               New York
000400 Samsung              Tokyo
000500 Zara                 Berlin
</pre>

<p>¡Bien! Ya tenemos el enlace creado y utilizable, y por último vamos a realizar una consulta que una la tabla <strong>Tiendas</strong> (tabla almacenada en el primer servidor) y la tabla <strong>Marcas</strong> (tabla almacenada en el segundo servidor):</p>
<pre>

</pre>

<p>Como hemos visto, hemos podido realizar la consulta correctamente, por lo que habríamos terminado este ejercicio.</p>
<h4>Enlace entre dos servidores de bases de datos PostgreSQL</h4>
<p>En este apartado vamos a realizar un enlace entre dos servidores <strong>PostgreSQL</strong>.</p>
<p><em>PostgreSQL</em> hace uso de la extensión <code>dblink</code> para realizar o aceptar consultas desde enlaces, por lo que debemos instalar esta herramienta que se encuentra en el paquete llamado <code>postgresql-contrib</code></p>
<pre>
apt install postgresql-contrib -y
</pre>

<p>Hecho esto, procederemos a editar el fichero de configuración de ambos servidores <code>/etc/postgresql/XXX/main/postgresql.conf</code>, y en él descomentaremos la línea llamada <code>listen_addresses</code>. Como valor le estableceremos la IP que nos interese que escuche nuestro servidor, en mi caso introduzco el valor <strong>*</strong> para que así escuche cualquier petición. De manera que la línea resultante sería la siguiente:</p>
<pre>
listen_addresses = '*'
</pre>

<p>Como segunda modificación, que también debe realizarse en ambos servidores, tenemos que dirigirnos al fichero <code>/etc/postgresql/XXX/main/pg_hba.conf</code> y buscar la siguiente línea:</p>
<pre>
host    all             all             127.0.0.1/32            md5
</pre>

<p>Esta línea actualmente define que no se permita la conexión remota, ya que por defecto solo escucha peticiones de <em>localhost</em>. Por tanto cambiamos este valor, en mi caso especifico que escuche peticiones desde cualquier interfaz, y la línea queda de esta manera:</p>
<pre>
host    all             all             0.0.0.0/0            md5
</pre>

<p>Realizados los cambios, vamos a reiniciar los servicios de los dos servidores para así aplicar los nuevos cambios:</p>
<pre>
systemctl restart postgresql
</pre>

<p>Ya tenemos ambos servidores configurados correctamente y tan solo nos faltaría crear el enlace desde el primer servidor al segundo, y al revés.</p>
<p>Para ello, antes, voy a crear en ambos servidores un usuario llamado <strong>javierservX</strong>, y una base de datos de prueba llamada <strong>empresaX</strong>, en la que introduciré algunos registros de prueba.</p>
<pre>
root@servidor:~# su - postgres

postgres@servidor:~$ psql postgres
psql (11.9 (Debian 11.9-0+deb10u1))
Type "help" for help.

postgres=# CREATE USER javierserv1 WITH PASSWORD 'contraseña';
CREATE ROLE

postgres=# CREATE DATABASE empresa1;
CREATE DATABASE

postgres=# GRANT ALL PRIVILEGES ON DATABASE empresa1 TO javierserv1;
GRANT

postgres=# exit

--------------------------------------------------------------------------------

root@cliente:~# su - postgres

postgres@cliente:~$ psql postgres
psql (11.9 (Debian 11.9-0+deb10u1))
Type "help" for help.

postgres=# CREATE USER javierserv2 WITH PASSWORD 'contraseña';
CREATE ROLE

postgres=# CREATE DATABASE empresa2;
CREATE DATABASE

postgres=# GRANT ALL PRIVILEGES ON DATABASE empresa2 TO javierserv2;
GRANT

postgres=# exit
</pre>

<p>Una vez creados ambos usuarios y ambas bases de datos, inserto una serie de tablas con sus respectivos registros. Puedes encontrar la información <a href="images/abd_interconexiones_de_servidores_de_bases_de_datos/scriptpostgresql.txt">aquí</a>.</p>
<p>Hecho esto, llegó el momento de crear los enlaces entre ambos servidores. Los enlaces deben crearse con el usuario administrador <strong>postgres</strong> ya que es el usuario que posee los permisos para ello, y deben crearse en las bases de datos <strong>empresaX</strong>, ya que los usuarios <strong>javierservX</strong>, solo poseen permisos sobre ellas.</p>
<p>Explicado esto, en primer lugar, crearemos el enlace desde el primer servidor hacia el segundo:</p>
<pre>
postgres@servidor:~$ psql postgres
psql (11.9 (Debian 11.9-0+deb10u1))
Type "help" for help.

postgres=# \c empresa1
You are now connected to database "empresa1" as user "postgres".

empresa1=# CREATE EXTENSION dblink;
CREATE EXTENSION

empresa1=# exit
</pre>

<p>Y ahora al revés, desde el segundo hacia el primero:</p>
<pre>
postgres@cliente:~$ psql postgres
psql (11.9 (Debian 11.9-0+deb10u1))
Type "help" for help.

postgres=# \c empresa2
You are now connected to database "empresa2" as user "postgres".

empresa2=# CREATE EXTENSION dblink;
CREATE EXTENSION

empresa2=# exit
</pre>

<p>En principio ya estaría todo listo, así que vamos a probarlo. Empezaremos haciendo una consulta desde el <em>servidor1</em> hacia el <em>servidor2</em>:</p>
<pre>
postgres@servidor:~$ psql -h 127.0.0.1 -U javierserv1 -d empresa1
Password for user javierserv1:
psql (11.9 (Debian 11.9-0+deb10u1))
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)
Type "help" for help.

empresa1=> select * from dblink('dbname=empresa2 host=192.168.0.44 user=javierserv2 password=contraseña', 'select * from Empleados') AS Empleados (NIF VARCHAR, Nombre VARCHAR, AnyoNacimiento NUMERIC, Cod_Tienda VARCHAR);
    nif    |      nombre       | anyonacimiento | cod_tienda
-----------+-------------------+----------------+------------
 12345678A | Rodrigo Fernandez |           1974 | 000001
 12345678B | Cristina Perez    |           1976 | 000002
 12345678C | Ramon Fuentes     |           1983 | 000003
 12345678D | Maria Diaz        |           1969 | 000004
 12345678E | Alejandro Cortes  |           1978 | 000005
(5 rows)
</pre>

<p>Vemos que nos muestra la información correctamente. Pero, ¿y si quisiéramos unir una consulta de la tabla del primer servidor y de la tabla del segundo servidor? Pues vamos a ver si podríamos hacerlo:</p>
<pre>
postgres@servidor:~$ psql -h 127.0.0.1 -U javierserv1 -d empresa1
Password for user javierserv1:
psql (11.9 (Debian 11.9-0+deb10u1))
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)
Type "help" for help.

empresa1=> select Tiendas.Codigo AS Codigo, Tiendas.Nombre AS NombreTienda, Tiendas.Especialidad AS Especialidad, Tiendas.Localizacion AS Localizacion, Empleados.NIF AS NIF, Empleados.Nombre AS NombreEmpleado, Empleados.AnyoNacimiento AS AnyoNacimiento, Empleados.Cod_Tienda AS Cod_Tienda

empresa1-> from Tiendas, dblink('dbname=empresa2 host=192.168.0.44 user=javierserv2 password=contraseña', 'select * from Empleados') AS Empleados (NIF VARCHAR, Nombre VARCHAR, AnyoNacimiento NUMERIC, Cod_Tienda VARCHAR)

empresa1-> where Tiendas.Codigo=Empleados.Cod_Tienda;

 codigo |   nombretienda    | especialidad | localizacion |    nif    |  nombreempleado   | anyonacimiento | cod_tienda
--------+-------------------+--------------+--------------+-----------+-------------------+----------------+------------
 000001 | Javi s Pet        | Animales     | Sevilla      | 12345678A | Rodrigo Fernandez |           1974 | 000001
 000002 | Javi s Sport      | Deportes     | Cordoba      | 12345678B | Cristina Perez    |           1976 | 000002
 000003 | Javi s Food       | Comida       | Granada      | 12345678C | Ramon Fuentes     |           1983 | 000003
 000004 | Javi s Technology | Tecnologia   | Cadiz        | 12345678D | Maria Diaz        |           1969 | 000004
 000005 | Javi s Clothes    | Ropa         | Huelva       | 12345678E | Alejandro Cortes  |           1978 | 000005
(5 rows)

</pre>

<p>Efectivamente podemos unir ambas consultas, ¡esto es maravilloso!</p>
<p>(El resultado de la consulta no tiene mucho sentido, pero lo importante es mostrar el funcionamiento).</p>
<p>Para terminar con este apartado, haremos la misma consulta pero esta vez desde el segundo servidor, y de esta manera asegurarnos que ambos enlaces funcionan.</p>
<pre>
postgres@cliente:~$ psql -h 127.0.0.1 -U javierserv2 -d empresa2
Password for user javierserv2:
psql (11.9 (Debian 11.9-0+deb10u1))
SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384, bits: 256, compression: off)
Type "help" for help.

empresa2=> select Tiendas.Codigo AS Codigo, Tiendas.Nombre AS NombreTienda, Tiendas.Especialidad AS Especialidad, Tiendas.Localizacion AS Localizacion, Empleados.NIF AS NIF, Empleados.Nombre AS NombreEmpleado, Empleados.AnyoNacimiento AS AnyoNacimiento, Empleados.Cod_Tienda AS Cod_Tienda

empresa2-> from Empleados, dblink('dbname=empresa1 host=192.168.0.43 user=javierserv1 password=contraseña', 'select * from Tiendas') AS Tiendas (Codigo VARCHAR, Nombre VARCHAR, Especialidad VARCHAR, Localizacion VARCHAR)

empresa2-> where Empleados.Cod_Tienda=Tiendas.Codigo;

codigo |   nombretienda    | especialidad | localizacion |    nif    |  nombreempleado   | anyonacimiento | cod_tienda
--------+-------------------+--------------+--------------+-----------+-------------------+----------------+------------
000001 | Javi s Pet        | Animales     | Sevilla      | 12345678A | Rodrigo Fernandez |           1974 | 000001
000002 | Javi s Sport      | Deportes     | Cordoba      | 12345678B | Cristina Perez    |           1976 | 000002
000003 | Javi s Food       | Comida       | Granada      | 12345678C | Ramon Fuentes     |           1983 | 000003
000004 | Javi s Technology | Tecnologia   | Cadiz        | 12345678D | Maria Diaz        |           1969 | 000004
000005 | Javi s Clothes    | Ropa         | Huelva       | 12345678E | Alejandro Cortes  |           1978 | 000005
(5 rows)
</pre>

<h4>Enlace entre un servidor ORACLE y otro PostgreSQL o MySQL empleando Heterogeneus Services</h4>
    </article>

        <div class="tags">
            <p><strong><a href="/tags">tags:</a></strong> <a href="/tag/base-de-datos.html">Base de Datos</a>, <a href="/tag/oracle.html">Oracle</a>, <a href="/tag/mysql.html">MySQL</a>, <a href="/tag/mariadb.html">MariaDB</a>, <a href="/tag/postgresql.html">PostgreSQL</a></p>
        </div>

    <hr>

            </div>
        </div>
    </div>

    <hr>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    <ul class="list-inline text-center">
                            <li>
                                <a href="https://www.instagram.com/javierpzh/">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://twitter.com/jperezhid_">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://github.com/javierpzh">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="https://www.facebook.com/javier.perezhidalgo.904">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li>
                                <a href="mailto:javierperezhidalgo01@gmail.com">
                                    <span class="fa-stack fa-lg">
                                        <i class="fa fa-circle fa-stack-2x"></i>
                                        <i class="fa fa-envelope-square fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                    </ul>
<p class="copyright text-muted">
    Blog creado por <a href="http://www.instagram.com/javierpzh/">Javier Pérez Hidalgo</a>,
    con la utilización de <a href="https://blog.getpelican.com/">Pelican</a>. <br />        &copy;  Javier Pérez Hidalgo
</p>                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="/theme/js/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="/theme/js/bootstrap.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="/theme/js/clean-blog.min.js"></script>

</body>

</html>